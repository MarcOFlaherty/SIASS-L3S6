---
title: "S√©quence 1 : Prise en main & statistiques descriptives"
subtitle: "Analyse des in√©galit√©s de d√©veloppement (Donn√©es PNUD)"
author: "Marc O'Flaherty"
format: 
  revealjs:
    theme: simple
    slide-number: c/t
    lightbox: true
    chalkboard: true
    footer: "S√©quence 1 - L3 Sciences Sociales"
    echo: true
---

# Q1. D√©couverte des donn√©es
*Importation et caract√©risation*

## Pr√©sentation des donn√©es (Q1) {.scrollable}

* **Population √©tudi√©e :** Un √©chantillon de 44 pays (Source PNUD 2017).
* **Individu statistique :** Le Pays (et non l'habitant).
* **Variables cl√©s :**
    * `IDH` : Indice synth√©tique (0 √† 1).
    * `PIB/t√™te` : Richesse.
    * `Esp√©rance de vie` : Sant√©.
    * `Population` : D√©mographie.
    * `Ratio Palma` : In√©galit√©s (Top 10% / Bottom 40%).

::: {.callout-note}
### Objectif Q1
T√©l√©charger le fichier, l'ouvrir et identifier ces variables.
:::

## Importation : La technique

::: {.panel-tabset}

### üü¢ Sur Excel
1.  Ouvrez le fichier `DonneesTD1.xlsx`.

### üîµ Sur R
::: {style="max-height: 400px; overflow-y: auto;"}
```{r}
#| label: setup
#| echo: true
#| message: false
#| warning: false

#install.packages("ggplot2")
#install.packages("dplyr")
#install.packages("readxl")

library(ggplot2)
library(dplyr)
library(readxl)

# --- √âTAPE 1 : D√âFINIR LE FICHIER ---
# Remplacez ce chemin par le v√¥tre !
mon_fichier <- "data/DonneesTD1.xlsx"

# --- √âTAPE 2 : IMPORTER ---
df <- read_excel(mon_fichier)

# Aper√ßu
head(df, 3)
```
:::
:::

# Q2 & Q3. Indicateurs simples
*Moyenne, Variance, M√©diane, Quartiles*

## Tendance centrale & Dispersion (Q2) {.scrollable}

On demande la **Moyenne** et la **Variance**.

::: {.callout-tip}
### üü¢ Sur Excel (Standard Scientifique)
* **Moyenne :** `=MOYENNE(Plage)`
* **Variance :** `=VAR.S(Plage)`
    * *Note :* On utilise la variance d'√©chantillon (.S) qui est le standard en sciences sociales (comme sur R).
* **√âcart-type :** `=ECARTYPE.STANDARD(Plage)`
:::

::: {style="max-height: 300px; overflow-y: auto;"}
```{r}
#| label: q2-stats
#| echo: true

# Calcul des indicateurs pour l'Esp√©rance de vie
df %>% summarise(
  Moyenne = mean(`Esp Vie Naiss 2017`, na.rm = TRUE),
  Variance = var(`Esp Vie Naiss 2017`, na.rm = TRUE),
  Ecart_Type = sd(`Esp Vie Naiss 2017`, na.rm = TRUE)
) 
```
:::

## M√©diane et quantiles (Q3) {.scrollable}

On d√©coupe la distribution pour voir les in√©galit√©s.

::: {.callout-tip}
### üü¢ Sur Excel
* **M√©diane :** `=MEDIANE(Plage)`
* **Quartiles :** `=QUARTILE.EXC(Plage; 1)` (Q1) et `3` (Q3).
* **D√©ciles :** `=CENTILE(Plage; 0,1)` (D1) et `0,9` (D9).
:::

**R√©sultats R :**
```{r}
#| label: q3-quantiles
#| echo: true

# La fonction quantile fait tout d'un coup
quantile(df$`Esp Vie Naiss 2017`, 
         probs = c(0.1, 0.25, 0.5, 0.75, 0.9), 
         na.rm = TRUE)
```
:::

# Q4, Q5 & Q6. Visualisation
*Boxplot, graphique cumul√© et Histogramme*

## La Bo√Æte √† moustache (Q4) {.scrollable}

Visualiser la m√©diane, l'√©cart interquartile et les extr√™mes.

::: {.columns}
::: {.column width="40%"}
**Lecture :**
* Trait gras = M√©diane (Q2).  
* Bo√Æte = 50% des pays.  
* Extr√™mes = Pays atypiques.  
:::

::: {.column width="60%"}
::: {style="max-height: 400px; overflow-y: auto;"}
```{r}
#| label: q4-boxplot
#| fig-height: 5

ggplot(df, aes(y = `Esp Vie Naiss 2017`)) +
  geom_boxplot(fill = "#404080", color = "black", alpha = 0.6) +
  labs(title = "Q4 - Esp√©rance de vie : Boite √† moustaches", y = "Ann√©es") +
  theme_minimal() +
  theme(axis.text.x = element_blank())
```
:::
:::
:::

::: {.callout-tip}
### üü¢ Sur Excel
Insertion $\rightarrow$ Graphiques recommand√©s $\rightarrow$ Tous les graphiques $\rightarrow$ **Bo√Æte √† moustaches**.
:::

## Graphique cumul√© (Q5) {.scrollable}

::: {.callout-tip}
### üü¢ Sur Excel (M√©thode simple)
1.  **Triez** la colonne `Esp√©rance de vie` du plus petit au plus grand.  
2. *Cr√©ez* la m√©diane et **copier/coller** en valeur.  
2.  S√©lectionnez les valeurs.  
3.  Insertion $\rightarrow$ **Histogramme (ou Barres)**.  
    * *R√©sultat :* Des b√¢tons de plus en plus grands.  
:::

**Le r√©sultat identique sur R (donn√©es tri√©es) :**

::: {style="max-height: 450px; overflow-y: auto;"}
```{r}
#| label: q5-sorted-bars-quantiles
#| fig-height: 5

# 1. On trie les donn√©es (comme sur Excel)
df_trie <- df %>%
  filter(!is.na(`Esp Vie Naiss 2017`)) %>%
  arrange(`Esp Vie Naiss 2017`) %>%
  mutate(Rang = row_number())

# 2. On calcule les valeurs des quantiles pour les lignes
# D1 (10%), Q1 (25%), Q3 (75%), D9 (90%)
vals_q <- quantile(df_trie$`Esp Vie Naiss 2017`, probs = c(0.1, 0.25, 0.75, 0.9))

# 3. Le graphique
ggplot(df_trie, aes(x = Rang, y = `Esp Vie Naiss 2017`)) +
  geom_col(fill = "#404080", width = 0.8, alpha = 0.7) +
  
  # Ligne de la M√©diane (d√©j√† pr√©sente)
  geom_hline(yintercept = median(df_trie$`Esp Vie Naiss 2017`), 
             color = "#b89e14", linewidth = 1.2) +
  
  # Ajout des lignes pour D1, Q1, Q3, D9
  geom_hline(yintercept = vals_q, linetype = "dashed", color = "grey40", alpha = 0.8) +
  
  # Annotations pour la M√©diane
  annotate("text", x = 5, y = 78, label = "M√©diane", color = "#b89e14", fontface = "bold") +
  
  # Annotations pour les autres seuils
  annotate("text", x = 1, y = vals_q["10%"] - 3, label = "D1", color = "grey40", size = 3) +
  annotate("text", x = 1, y = vals_q["25%"] - 3, label = "Q1", color = "grey40", size = 3) +
  annotate("text", x = 1, y = vals_q["75%"] + 3, label = "Q3", color = "grey40", size = 3) +
  annotate("text", x = 1, y = vals_q["90%"] + 3, label = "D9", color = "grey40", size = 3) +

  labs(title = "Q5 : Distribution tri√©e avec Quantiles (D1, Q1, Q3, D9)", 
       y = "Esp√©rance de vie (en ann√©es)", 
       x = "Pays (du moins au plus √¢g√©)") +
  theme_minimal()
```
:::

---

## Histogramme (Q6) {.scrollable}
*Constituer des classes appropri√©es (5 ans).*

::: {.callout-tip}
### üü¢ Sur Excel
1.  S√©lectionnez la colonne "Esp√©rance de vie".  
2.  Insertion $\rightarrow$ Graphiques statistiques (l'ic√¥ne bleue avec des barres) $\rightarrow$ **Histogramme**.  
3.  **Important :** Par d√©faut, les classes sont automatiques.  
    * *Clic droit sur l'axe horizontal* $\rightarrow$ *Mise en forme de l'axe*.  
    * Option "Largeur des classes " $\rightarrow$ √âcrire **5** $\rightarrow$ Classe de soupassement : **50**.     
:::

**Le r√©sultat attendu (Version R) :**

::: {style="max-height: 400px; overflow-y: auto;"}
```{r}
#| label: q6-histo-clean
#| fig-height: 5

ggplot(df, aes(x = `Esp Vie Naiss 2017`)) +
  geom_histogram(
    binwidth = 5,       # Largeur de 5 ans
    boundary = 50,      # On force le d√©marrage sur un chiffre rond (50)
    closed = "left",    # L'intervalle est [50, 55[ (50 inclus, 55 exclu)
    fill = "#1591EA", 
    color = "white"
  ) +
  # C'est ici qu'on force l'affichage des bornes sur l'axe X
  scale_x_continuous(breaks = seq(50, 90, 5)) + 
  
  labs(
    title = "Q6 : Histogramme (Classes de 5 ans)", 
    subtitle = "Chaque barre repr√©sente une tranche stricte (ex: [75 √† 80[ ans)",
    y = "Nombre de pays", 
    x = "Esp√©rance de vie"
  ) +
  theme_minimal()
```
:::

# Q7, Q8 & Q9. Bivari√© & r√©gressions
*Expliquer les liens*

## Covariances et Corr√©lations (Q7) {.scrollable}
*Comprendre les liens avec l'IDH.*

On calcule d'abord la **Covariance** (le lien brut) puis la **Corr√©lation** (le lien standardis√©).

::: {.callout-tip}
### üü¢ Sur Excel
* **Covariance :** `=COVARIANCE.STANDARD(Plage1; Plage2)`
    * *R√©sultat flou (ex: 4500)*.
* **Corr√©lation :** `=COEFFICIENT.CORRELATION(Plage1; Plage2)`
    * *R√©sultat clair (entre -1 et 1)*.
:::

**R√©sultats sur R (Matrices compl√®tes) :**

::: {style="max-height: 450px; overflow-y: auto;"}
```{r}
#| label: q7-cov-cor
#| echo: true

# 1. S√©lection des variables
vars <- df %>% 
  select(`IDH 2017`, `PIB/t√™te (2017)`, `Esp Vie Naiss 2017`, `Ann√©es √©ducation (2017)`)

# 2. Matrice de COVARIANCE (Brute)
# Difficile √† interpr√©ter car les unit√©s sont m√©lang√©es ($ * Ann√©es)
print("--- Matrice de COVARIANCE ---")
cov(vars, use = "complete.obs") %>% round(1)

# 3. Matrice de CORR√âLATION (Standardis√©e)
# Id√©ale pour voir les liens avec l'IDH (Max = 1)
print("--- Matrice de CORR√âLATION ---")
cor(vars, use = "complete.obs") %>% round(2)
```
:::

## Nuage de points et R√©gression lin√©aire (Q8) {.scrollable}
*Esp√©rance de vie ~ PIB par t√™te.*

::: {style="max-height: 450px; overflow-y: auto;"}
```{r}
#| label: q8-reg
#| fig-height: 5

ggplot(df, aes(x = `PIB/t√™te (2017)`, y = `Esp Vie Naiss 2017`)) +
  geom_point(alpha = 0.6) +
  geom_smooth(method = "lm", color = "#C04657", se = FALSE) + # Droite de r√©gression
  labs(title = "Q8 : R√©gression lin√©aire", x = "PIB ($)", y = "Esp√©rance de vie") +
  theme_minimal()
```
:::
*La ligne droite ne colle pas parfaitement (le lien est courbe), mais la tendance est l√†.*

## R√©gression Lin√©aire Multiple (Q9) {.scrollable}
*Esp√©rance de vie ~ PIB + √âducation + Population*

On cherche √† expliquer la sant√© par toutes les variables disponibles (sauf l'IDH qui est une synth√®se).

::: {.callout-tip}
### üü¢ Sur Excel 
Excel impose une r√®gle stricte : les variables explicatives ($X$) doivent √™tre **coll√©es** (dans des colonnes adjacentes).  
1.  **Pr√©parez les donn√©es :** Dans une nouvelle zone, copiez la colonne `PIB`, la colonne `√âducation` et la colonne `Population` pour qu'elles soient c√¥te √† c√¥te.  
2.  **Outil :** Onglet **Donn√©es** $\rightarrow$ **Utilitaire d'analyse** $\rightarrow$ **R√©gression**. [En cas d'absence de l'option üîó](https://www.youtube.com/watch?v=hy-lTUZ4whk)  
3.  **Param√®tres :**  
    * **Plage Y :** La colonne `Esp√©rance de vie`.  
    * **Plage X :** Le bloc des **3 colonnes** (PIB, √âducation, Pop) ensemble.  
    * Cochez **"Intitul√©s"** (Labels).  
:::

**R√©sultat sur R :**  

::: {style="max-height: 400px; overflow-y: auto;"}
```{r}
#| label: q9-multi-final
#| echo: true

# Mod√®le sans le Palma (donn√©es manquantes) et sans l'IDH (tautologie)
modele_safe <- lm(`Esp Vie Naiss 2017` ~ `PIB/t√™te (2017)` + 
                  `Ann√©es √©ducation (2017)` + 
                  `Population totale (2017)`, 
                  data = df)

# Affichage des coefficients arrondis
summary(modele_safe)$coefficients %>% round(5)
```
:::

### Interpr√©tation des r√©sultats  

1.  **L'Intercept (Ordonn√©e √† l'origine) : ~43 ans**  
    * *C'est quoi ?* C'est l'esp√©rance de vie th√©orique d'un pays qui aurait   **0 partout** (0$ PIB, 0 √©ducation).  
    * *Sens :* C'est notre "socle biologique" minimum sans aucun d√©veloppement.  

2.  **L'√âducation (Significatif `***`) :**  
    * C'est le **moteur principal**. Chaque ann√©e d'√©tude suppl√©mentaire fait gagner environ **2,15 ans** d'esp√©rance de vie (Coeff: 2.159).  

3.  **La surprise du PIB (Non-significatif) :**  
    * Sa p-value est de **0.71** (> 0.05).  
    * *Pourquoi ?* Car l'√âducation a "absorb√©" l'effet richesse. Le mod√®le nous dit : ce n'est pas d'√™tre riche qui compte, mais d'√™tre √©duqu√© (ce qui arrive souvent quand on est riche).  

4.  **La Population (Non-significatif) :**  
    * La taille du pays n'a aucun impact sur la dur√©e de vie.  
    
# Q10. Le pi√®ge de l'agr√©gation
*Pays vs Population mondiale*

## Esp√©rance de vie mondiale (Q10) {.scrollable}
*Calculez l'esp√©rance de vie des habitants de la plan√®te et sa variance inter-pays.*

On cherche ici √† d√©crire la "population mondiale" et non plus une liste de pays. Il faut donc **pond√©rer** par la population.

::: {.callout-tip}
### üü¢ Sur Excel (M√©thode avec pond√©ration)  

Pour la variance pond√©r√©e, il faut une colonne interm√©diaire.  
1.  **Moyenne Monde ($M$) :** `=SOMMEPROD(Esp; Pop) / SOMME(Pop)`  
    * *Cela donne l'esp√©rance de vie moyenne d'un terrien.*  
2.  **Colonne "Ecart Carr√© Pond√©r√©" :**  
    * Formule : `= Population * (Esp√©rance - $M)^2`  
3.  **Variance Inter-Pays :** `= SOMME(Colonne_Ecart) / SOMME(Pop)`  
:::

**R√©sultats sur R :**

::: {style="max-height: 400px; overflow-y: auto;"}
```{r}
#| label: q10-monde-pondere
#| echo: true

# 1. Moyenne Mondiale (Pond√©r√©e)
# C'est l'esp√©rance de vie moyenne d'un √™tre humain sur Terre (dans notre √©chantillon)
# Moyenne non pond√©r√©e
moy_Q2 <- mean(df$`Esp Vie Naiss 2017`, na.rm = TRUE)

# Moyenne pond√©r√©e
moy_monde <- weighted.mean(df$`Esp Vie Naiss 2017`, 
                           w = df$`Population totale (2017)`, 
                           na.rm = TRUE)

# 2. Variance Inter-Pays (Pond√©r√©e)
# Formule : Somme(Pop * (Esp - Moy)^2) / Somme(Pop)
# Variance non pond√©r√©e
var_Q2 <- var(df$`Esp Vie Naiss 2017`, na.rm = TRUE)
# √âcart type non pond√©r√©e
sd_Q2 <- sd(df$`Esp Vie Naiss 2017`, na.rm = TRUE)

# Moyenne pond√©r√©e
var_inter <- sum(df$`Population totale (2017)` * (df$`Esp Vie Naiss 2017` - moy_monde)^2, na.rm = TRUE) / 
             sum(df$`Population totale (2017)`, na.rm = TRUE)

# Affichage des r√©sultats
data.frame(
  Indicateur = c("Esp√©rance de vie (Q2 - non pond√©r√©e)", "Esp√©rance de vie (Monde - pond√©r√©e)", "Variance non pond√©r√©e", "Variance Inter-Pays (Pond√©r√©e)", "Ecart-type non pond√©r√©", "Ecart-type Inter-Pays"),
  Valeur = c(moy_Q2, moy_monde, var_Q2, var_inter, sd_Q2, sqrt(var_inter)) # sqrt -> racine carr√© de la variance
) %>% knitr::kable(digits = 2)
```
:::

### Commentaire
1.  **L'Esp√©rance de vie mondiale :** Une fois pond√©r√©e, la moyenne est diff√©rente de la moyenne simple des pays. Ici, elle est tir√©e vers le haut, √† la marge.    
2.  **La Variance Inter-Pays :** Elle mesure les in√©galit√©s **entre les nations**.  
    * *Ce qu'elle rate :* Elle ignore les in√©galit√©s **√† l'int√©rieur** des pays (riches vs pauvres au sein d'un m√™me pays).  
    * *Conclusion :* La vraie variance de l'esp√©rance de vie mondiale (si on prenait chaque humain individuellement) serait beaucoup plus √©lev√©e, car elle ajouterait les in√©galit√©s internes aux in√©galit√©s nationale et internationales.    


# Conclusion (Q11-13)

## Comparaison et bilan

* **Q11 (Ouverture) :** Vous pouvez tester d'autres mod√®les de r√©gression sur d'autres variables et/ou d'autres donn√©es. .  
* **Q12 (Excel vs R) :**
    * **Excel :** Intuitif pour "voir" les donn√©es, bon pour la saisie manuelle.
    * **R :** Plus puissant pour les graphiques (ggplot), la mod√©lisation (lm) et surtout la **reproductibilit√©** (on relance le script, tout se met √† jour).


## Q13 : Synth√®se et interpr√©tation des r√©sultats {.scrollable}  

L'objectif √©tait d'analyser les d√©terminants de l'esp√©rance de vie √† travers un √©chantillon de 44 pays en 2017. Voici les trois conclusions majeures issues de nos traitements statistiques.  

### A. Une distribution mondiale √©tonnamment stable (Q2 vs Q10)  
Contrairement √† l'intuition, la prise en compte de la taille de la population ne change presque rien aux r√©sultats globaux sur cet √©chantillon :  

* **Moyenne :** L'esp√©rance de vie moyenne par pays est de **73,43 ans**. L'esp√©rance de vie mondiale pond√©r√©e (celle d'un "habitant terrien moyen") est quasi identique √† **73,48 ans**.  
* **Interpr√©tation :** Cela signifie qu'il n'y a pas de biais d√©mographique majeur : les g√©ants d√©mographiques de l'√©chantillon ne sont ni syst√©matiquement plus pauvres, ni plus riches que les petits pays.  
* **In√©galit√©s :** La variance reste √©lev√©e, signe que le lieu de naissance d√©termine encore fortement la dur√©e de vie.  

### B. L'√âducation est le moteur, la richesse n'est que le carburant (Q9)
La r√©gression multiple ($R^2 = 0,89$) nous a permis de d√©partager les facteurs d'influence avec pr√©cision :  

1.  **L'√âducation est la cause r√©elle :** C'est la seule variable hautement significative ($p < 0,001$). Chaque ann√©e d'√©tude suppl√©mentaire augmente l'esp√©rance de vie de **2,16 ans**.  
2.  **L'effet "masqu√©" du PIB :** Une fois l'√©ducation prise en compte, le PIB par t√™te devient non-significatif ($p = 0,72$).  
    * *Sens sociologique :* La richesse √©conomique n'est pas une fin en soi pour la sant√©. Elle n'est utile que si elle est convertie en services publics et en **√©ducation** notamment (ex : USA).  
3.  **La neutralit√© d√©mographique :** La taille de la population n'a aucun impact ($p = 0,60$).  

### C. Le "socle biologique"
L'ordonn√©e √† l'origine (Intercept) est de **43,05 ans**.  
Cela repr√©sente l'esp√©rance de vie th√©orique "brute" d'une population qui n'aurait aucune instruction ni d√©veloppement √©conomique. L'√©cart entre ce socle (43 ans) et la moyenne actuelle (~73,5 ans) mesure l'apport du d√©veloppement humain.  

# Fin de la s√©quence 1

**Merci de votre attention !**

::: {.callout-note appearance="minimal"}
### üîó Acc√©der au corrig√©
[Cliquez ici pour acc√©der au Excel corrig√©](https://drive.google.com/drive/folders/1mCL7dYh4UpdKQz0c729nowAzpDm6N8cr?usp=sharing)
:::

